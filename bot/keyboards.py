"""
ĞšĞ»Ğ°Ğ²Ğ¸Ğ°Ñ‚ÑƒÑ€Ñ‹ Ğ¸ ĞºĞ½Ğ¾Ğ¿ĞºĞ¸ Ğ´Ğ»Ñ Telegram Ğ±Ğ¾Ñ‚Ğ°
"""

from aiogram.types import (
    InlineKeyboardMarkup, InlineKeyboardButton,
    ReplyKeyboardMarkup, KeyboardButton,
    WebAppInfo
)
from bot.config import Config

def get_main_menu_keyboard(user_full_name: str = None) -> ReplyKeyboardMarkup:
    """Ğ“Ğ»Ğ°Ğ²Ğ½Ğ¾Ğµ Ğ¼ĞµĞ½Ñ Ğ´Ğ»Ñ ÑĞ¾Ñ‚Ñ€ÑƒĞ´Ğ½Ğ¸ĞºĞ¾Ğ²"""

    # Ğ¡Ğ¾Ğ·Ğ´Ğ°ĞµĞ¼ ĞºĞ½Ğ¾Ğ¿ĞºÑƒ Ğ´Ğ»Ñ Ğ¾Ñ‚Ñ‡Ñ‘Ñ‚Ğ° Ñ Ğ¿Ñ€ÑĞ¼Ñ‹Ğ¼ WebApp
    report_button = KeyboardButton(text="ğŸ“Š ĞÑ‚Ğ¿Ñ€Ğ°Ğ²Ğ¸Ñ‚ÑŒ Ğ¾Ñ‚Ñ‡Ñ‘Ñ‚")
    if user_full_name:
        from urllib.parse import quote
        webapp_url = f"{Config.WEBAPP_URL}?user_name={quote(user_full_name)}"
        report_button = KeyboardButton(
            text="ğŸ“Š ĞÑ‚Ğ¿Ñ€Ğ°Ğ²Ğ¸Ñ‚ÑŒ Ğ¾Ñ‚Ñ‡Ñ‘Ñ‚",
            web_app=WebAppInfo(url=webapp_url)
        )

    keyboard = ReplyKeyboardMarkup(
        keyboard=[
            [
                KeyboardButton(text="ğŸ“ˆ ĞœĞ¾Ğ¹ ÑÑ‚Ğ°Ñ‚ÑƒÑ"),
                KeyboardButton(text="â„¹ï¸ ĞŸĞ¾Ğ¼Ğ¾Ñ‰ÑŒ")
            ],
            [report_button]
        ],
        resize_keyboard=True,
        one_time_keyboard=False,
        input_field_placeholder="Ğ’Ñ‹Ğ±ĞµÑ€Ğ¸Ñ‚Ğµ Ğ´ĞµĞ¹ÑÑ‚Ğ²Ğ¸Ğµ..."
    )
    return keyboard

def get_report_keyboard() -> InlineKeyboardMarkup:
    """ĞšĞ»Ğ°Ğ²Ğ¸Ğ°Ñ‚ÑƒÑ€Ğ° Ğ´Ğ»Ñ Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²ĞºĞ¸ Ğ¾Ñ‚Ñ‡Ñ‘Ñ‚Ğ° Ñ‡ĞµÑ€ĞµĞ· Mini App"""
    webapp = WebAppInfo(url=Config.WEBAPP_URL)

    keyboard = InlineKeyboardMarkup(inline_keyboard=[
        [InlineKeyboardButton(text="ğŸ“Š ĞÑ‚ĞºÑ€Ñ‹Ñ‚ÑŒ Ñ„Ğ¾Ñ€Ğ¼Ñƒ Ğ¾Ñ‚Ñ‡Ñ‘Ñ‚Ğ°", web_app=webapp)],
        [InlineKeyboardButton(text="âŒ ĞÑ‚Ğ¼ĞµĞ½Ğ°", callback_data="cancel_report")]
    ])
    return keyboard

def get_admin_keyboard() -> InlineKeyboardMarkup:
    """ĞĞ´Ğ¼Ğ¸Ğ½Ğ¸ÑÑ‚Ñ€Ğ°Ñ‚Ğ¸Ğ²Ğ½Ğ°Ñ ĞºĞ»Ğ°Ğ²Ğ¸Ğ°Ñ‚ÑƒÑ€Ğ°"""
    keyboard = InlineKeyboardMarkup(inline_keyboard=[
        [InlineKeyboardButton(text="ğŸ“Š Ğ¡Ñ‚Ğ°Ñ‚ÑƒÑ Ğ¾Ñ‚Ñ‡Ñ‘Ñ‚Ğ¾Ğ² ÑĞµĞ³Ğ¾Ğ´Ğ½Ñ", callback_data="admin_today_status")],
        [InlineKeyboardButton(text="ğŸ‘¥ Ğ¡Ğ¿Ğ¸ÑĞ¾Ğº ÑĞ¾Ñ‚Ñ€ÑƒĞ´Ğ½Ğ¸ĞºĞ¾Ğ²", callback_data="admin_users_list")],
        [
            InlineKeyboardButton(text="âš™ï¸ ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ¸", callback_data="admin_settings"),
            InlineKeyboardButton(text="ğŸ“ˆ Ğ¡Ñ‚Ğ°Ñ‚Ğ¸ÑÑ‚Ğ¸ĞºĞ°", callback_data="admin_stats")
        ],
        [InlineKeyboardButton(text="ğŸ”„ ĞĞ±Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒ", callback_data="admin_refresh")]
    ])
    return keyboard

def get_admin_users_keyboard(users: list) -> InlineKeyboardMarkup:
    """ĞšĞ»Ğ°Ğ²Ğ¸Ğ°Ñ‚ÑƒÑ€Ğ° ÑĞ¾ ÑĞ¿Ğ¸ÑĞºĞ¾Ğ¼ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ĞµĞ¹ Ğ´Ğ»Ñ Ğ°Ğ´Ğ¼Ğ¸Ğ½Ğ°"""
    keyboard = []

    for user in users:
        status_emoji = "âœ…" if user.is_active else "âŒ"
        keyboard.append([
            InlineKeyboardButton(
                text=f"{status_emoji} {user.full_name}",
                callback_data=f"admin_user_{user.id}"
            )
        ])

    keyboard.append([
        InlineKeyboardButton(text="ğŸ”™ ĞĞ°Ğ·Ğ°Ğ´", callback_data="admin_back")
    ])

    return InlineKeyboardMarkup(inline_keyboard=keyboard)

def get_user_status_keyboard() -> InlineKeyboardMarkup:
    """ĞšĞ»Ğ°Ğ²Ğ¸Ğ°Ñ‚ÑƒÑ€Ğ° Ğ´Ğ»Ñ Ğ¿Ñ€Ğ¾ÑĞ¼Ğ¾Ñ‚Ñ€Ğ° ÑÑ‚Ğ°Ñ‚ÑƒÑĞ° Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ"""
    keyboard = InlineKeyboardMarkup(inline_keyboard=[
        [InlineKeyboardButton(text="ğŸ“Š ĞÑ‚Ğ¿Ñ€Ğ°Ğ²Ğ¸Ñ‚ÑŒ Ğ¾Ñ‚Ñ‡Ñ‘Ñ‚", callback_data="open_report_form")]
    ])
    return keyboard

def get_confirmation_keyboard(action: str) -> InlineKeyboardMarkup:
    """ĞšĞ»Ğ°Ğ²Ğ¸Ğ°Ñ‚ÑƒÑ€Ğ° Ğ¿Ğ¾Ğ´Ñ‚Ğ²ĞµÑ€Ğ¶Ğ´ĞµĞ½Ğ¸Ñ Ğ´ĞµĞ¹ÑÑ‚Ğ²Ğ¸Ñ"""
    keyboard = InlineKeyboardMarkup(inline_keyboard=[
        [
            InlineKeyboardButton(text="âœ… Ğ”Ğ°", callback_data=f"confirm_{action}"),
            InlineKeyboardButton(text="âŒ ĞĞµÑ‚", callback_data=f"cancel_{action}")
        ]
    ])
    return keyboard

def get_back_keyboard() -> InlineKeyboardMarkup:
    """ĞŸÑ€Ğ¾ÑÑ‚Ğ°Ñ ĞºĞ»Ğ°Ğ²Ğ¸Ğ°Ñ‚ÑƒÑ€Ğ° Ñ ĞºĞ½Ğ¾Ğ¿ĞºĞ¾Ğ¹ "ĞĞ°Ğ·Ğ°Ğ´" """
    keyboard = InlineKeyboardMarkup(inline_keyboard=[
        [InlineKeyboardButton(text="ğŸ”™ ĞĞ°Ğ·Ğ°Ğ´", callback_data="back")]
    ])
    return keyboard

def get_help_keyboard() -> InlineKeyboardMarkup:
    """ĞšĞ»Ğ°Ğ²Ğ¸Ğ°Ñ‚ÑƒÑ€Ğ° Ğ´Ğ»Ñ ÑĞ¿Ñ€Ğ°Ğ²ĞºĞ¸"""
    keyboard = InlineKeyboardMarkup(inline_keyboard=[
        [InlineKeyboardButton(text="ğŸ“Š ĞšĞ°Ğº Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²Ğ¸Ñ‚ÑŒ Ğ¾Ñ‚Ñ‡Ñ‘Ñ‚?", callback_data="help_report")],
        [InlineKeyboardButton(text="ğŸ“ˆ ĞšĞ°Ğº Ğ¿Ğ¾ÑĞ¼Ğ¾Ñ‚Ñ€ĞµÑ‚ÑŒ ÑÑ‚Ğ°Ñ‚ÑƒÑ?", callback_data="help_status")],
        [InlineKeyboardButton(text="â“ Ğ§Ğ°ÑÑ‚Ñ‹Ğµ Ğ²Ğ¾Ğ¿Ñ€Ğ¾ÑÑ‹", callback_data="help_faq")],
        [InlineKeyboardButton(text="ğŸ“ Ğ¡Ğ²ÑĞ·Ğ°Ñ‚ÑŒÑÑ Ñ Ğ¿Ğ¾Ğ´Ğ´ĞµÑ€Ğ¶ĞºĞ¾Ğ¹", callback_data="help_support")]
    ])
    return keyboard

def get_registration_keyboard() -> ReplyKeyboardMarkup:
    """ĞšĞ»Ğ°Ğ²Ğ¸Ğ°Ñ‚ÑƒÑ€Ğ° Ğ´Ğ»Ñ Ğ½Ğ°Ñ‡Ğ°Ğ»Ğ° Ñ€ĞµĞ³Ğ¸ÑÑ‚Ñ€Ğ°Ñ†Ğ¸Ğ¸"""
    keyboard = ReplyKeyboardMarkup(
        keyboard=[
            [KeyboardButton(text="âœ… ĞĞ°Ñ‡Ğ°Ñ‚ÑŒ Ñ€ĞµĞ³Ğ¸ÑÑ‚Ñ€Ğ°Ñ†Ğ¸Ñ")]
        ],
        resize_keyboard=True,
        one_time_keyboard=True
    )
    return keyboard

def get_admin_user_actions_keyboard(user_id: int) -> InlineKeyboardMarkup:
    """Ğ”ĞµĞ¹ÑÑ‚Ğ²Ğ¸Ñ Ñ ĞºĞ¾Ğ½ĞºÑ€ĞµÑ‚Ğ½Ñ‹Ğ¼ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ĞµĞ¼ Ğ´Ğ»Ñ Ğ°Ğ´Ğ¼Ğ¸Ğ½Ğ°"""
    keyboard = InlineKeyboardMarkup(inline_keyboard=[
        [InlineKeyboardButton(text="ğŸ‘¤ Ğ˜Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸Ñ", callback_data=f"admin_user_info_{user_id}")],
        [InlineKeyboardButton(text="ğŸ“Š ĞÑ‚Ñ‡Ñ‘Ñ‚Ñ‹ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ", callback_data=f"admin_user_reports_{user_id}")],
        [
            InlineKeyboardButton(text="âœ… ĞĞºÑ‚Ğ¸Ğ²Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ", callback_data=f"admin_activate_{user_id}"),
            InlineKeyboardButton(text="âŒ Ğ”ĞµĞ°ĞºÑ‚Ğ¸Ğ²Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ", callback_data=f"admin_deactivate_{user_id}")
        ],
        [InlineKeyboardButton(text="ğŸ—‘ Ğ£Ğ´Ğ°Ğ»Ğ¸Ñ‚ÑŒ", callback_data=f"admin_delete_{user_id}")],
        [InlineKeyboardButton(text="ğŸ”™ ĞĞ°Ğ·Ğ°Ğ´ Ğº ÑĞ¿Ğ¸ÑĞºÑƒ", callback_data="admin_users_list")]
    ])
    return keyboard